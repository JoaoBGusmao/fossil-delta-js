!function(t,r){"undefined"!=typeof module&&module.exports?module.exports=r():t.fossilDelta=r()}(this,function(){function t(){this.a=0,this.b=0,this.i=0,this.z=new Array(s),this.init=function(t,r){var n,e,i=0,u=0;for(n=0;s>n;n++)e=t[r+n],i=i+e&65535,u=u+(s-n)*e&65535,this.z[n]=e;this.a=65535&i,this.b=65535&u,this.i=0},this.next=function(t){var r=this.z[this.i];this.z[this.i]=t,this.i=this.i+1&s-1,this.a=this.a-r+t&65535,this.b=this.b-s*r+this.a&65535},this.value=function(){return(65535&this.a|(65535&this.b)<<16)>>>0}}function r(t){this.a=t,this.pos=0,this.haveBytes=function(){return this.pos<this.a.length},this.getByte=function(){var t=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw new RangeError("out of bounds");return t},this.getChar=function(){return String.fromCharCode(this.getByte())},this.getInt=function(){for(var t,r=0;(t=h[127&this.getByte()])>=0;)r=(r<<6)+t;return this.pos--,r>>>0}}function n(){this.a=[],this.toArray=function(){return this.a},this.putByte=function(t){this.a.push(255&t)},this.putChar=function(t){this.putByte(t.charCodeAt(0))},this.putInt=function(t){var r,n,e=[];if(0===t)return void this.putChar("0");for(r=0;t>0;r++,t>>>=6)e.push(o[63&t]);for(n=r-1;n>=0;n--)this.putByte(e[n])},this.putArray=function(t,r,n){r||(r=0),n||(n=t.length-r);for(var e=r;n>e;e++)this.a.push(t[e])}}function e(t){var r,n;for(r=1,n=64;t>=n;r++,n<<=6);return r}function i(t){for(var r=0,n=0,e=0,i=0,u=0,a=t.length;a>=16;)r=r+t[u+0]|0,n=n+t[u+1]|0,e=e+t[u+2]|0,i=i+t[u+3]|0,r=r+t[u+4]|0,n=n+t[u+5]|0,e=e+t[u+6]|0,i=i+t[u+7]|0,r=r+t[u+8]|0,n=n+t[u+9]|0,e=e+t[u+10]|0,i=i+t[u+11]|0,r=r+t[u+12]|0,n=n+t[u+13]|0,e=e+t[u+14]|0,i=i+t[u+15]|0,u+=16,a-=16;for(;a>=4;)r=r+t[u+0]|0,n=n+t[u+1]|0,e=e+t[u+2]|0,i=i+t[u+3]|0,u+=4,a-=4;switch(i=((i+(e<<8)|0)+(n<<16)|0)+(r<<24)|0,a){case 3:i=i+(t[u+2]<<8)|0;case 2:i=i+(t[u+1]<<16)|0;case 1:i=i+(t[u+0]<<24)|0}return i>>>0}function u(t){a.logError?a.logError(t):console.log("ERROR: "+t)}var a={},s=16,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map(function(t){return t.charCodeAt(0)}),h=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];return a.create=function(r,u){var a,o=new n,h=u.length,f=r.length,p=-1;if(o.putInt(h),o.putChar("\n"),s>=f)return o.putInt(h),o.putChar(":"),o.putArray(u),o.putInt(i(u)),o.putChar(";"),o.toArray();var l=Math.ceil(f/s),c=new Array(l),g=new Array(l);for(a=0;a<c.length;a++)c[a]=-1;for(a=0;a<g.length;a++)g[a]=-1;var d,y=new t;for(a=0;f-s>a;a+=s)y.init(r,a),d=y.value()%l,c[a/s]=g[d],g[d]=a/s;for(var v,C,A,m,I,b=0;h>b+s;)for(m=0,I=0,y.init(u,b),a=0,A=0;;){var w=250;for(d=y.value()%l,C=g[d];C>=0&&w-->0;){var z,B,x,k,E,R,S,D;for(v=C*s,k=0,R=v,S=b+a;f>R&&h>S&&r[R]===u[S];k++,R++,S++);for(k--,E=1;v>E&&a>=E&&r[v-E]===u[b+a-E];E++);E--,B=v-E,z=k+E+1,x=a-E,D=e(a-E)+e(z)+e(B)+3,z>=D&&z>A&&(A=z,m=v-E,I=x),C=c[C]}if(A>0){I>0&&(o.putInt(I),o.putChar(":"),o.putArray(u,b,b+I),b+=I),b+=A,o.putInt(A),o.putChar("@"),o.putInt(m),o.putChar(","),m+A-1>p&&(p=m+A-1),A=0;break}if(b+a+s>=h){o.putInt(h-b),o.putChar(":"),o.putArray(u,b,b+h-b),b=h;break}y.next(u[b+a+s]),a++}return h>b&&(o.putInt(h-b),o.putChar(":"),o.putArray(u,b)),o.putInt(i(u)),o.putChar(";"),o.toArray()},a.outputSize=function(t){var n=new r(t),e=n.getInt();return"\n"!==n.getChar()?(u("size integer not terminated by '\\n'"),-1):e},a.apply=function(t,e){var a,s=0,o=new r(e),h=t.length,f=e.length;if(a=o.getInt(),"\n"!==o.getChar())return u("size integer not terminated by '\\n'"),null;for(var p=new n;o.haveBytes();){var l,c;switch(l=o.getInt(),o.getChar()){case"@":if(c=o.getInt(),o.haveBytes()&&","!==o.getChar())return u("copy command not terminated by ','"),null;if(s+=l,s>a)return u("copy exceeds output file size"),null;if(c+l>h)return u("copy extends past end of input"),null;p.putArray(t,c,c+l);break;case":":if(s+=l,s>a)return u("insert command gives an output larger than predicted"),null;if(l>f)return u("insert count exceeds size of delta"),null;p.putArray(o.a,o.pos,o.pos+l),o.pos+=l;break;case";":var g=p.toArray();return l!==i(g)?(u("bad checksum"),null):s!==a?(u("generated size does not match predicted size"),null):g;default:return u("unknown delta operator"),null}}return u("unterminated delta"),null},a});