!function(t,r){"undefined"!=typeof module&&module.exports?module.exports=r():t.fossilDelta=r()}(this,function(){function t(){this.a=0,this.b=0,this.i=0,this.z=new Array(a),this.init=function(t,r){var e,n,i=0,o=0;for(e=0;a>e;e++)n=t[r+e],i=i+n&65535,o=o+(a-e)*n&65535,this.z[e]=n;this.a=65535&i,this.b=65535&o,this.i=0},this.next=function(t){var r=this.z[this.i];this.z[this.i]=t,this.i=this.i+1&a-1,this.a=this.a-r+t&65535,this.b=this.b-a*r+this.a&65535},this.value=function(){return(65535&this.a|(65535&this.b)<<16)>>>0}}function r(t){this.a=t,this.pos=0,this.haveBytes=function(){return this.pos<this.a.length},this.getByte=function(){var t=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw new RangeError("out of bounds");return t},this.getChar=function(){return String.fromCharCode(this.getByte())},this.getInt=function(){for(var t,r=0;this.haveBytes()&&(t=s[127&this.getByte()])>=0;)r=(r<<6)+t;return this.pos--,r>>>0}}function e(){this.a=[],this.toArray=function(){return this.a},this.putByte=function(t){this.a.push(255&t)},this.putChar=function(t){this.putByte(t.charCodeAt(0))},this.putInt=function(t){var r,e,n=[];if(0===t)return void this.putChar("0");for(r=0;t>0;r++,t>>>=6)n.push(h[63&t]);for(e=r-1;e>=0;e--)this.putByte(n[e])},this.putArray=function(t,r,e){r||(r=0),e||(e=t.length-r);for(var n=r;e>n;n++)this.a.push(t[n])}}function n(t){var r,e;for(r=1,e=64;t>=e;r++,e<<=6);return r}function i(t){for(var r=0,e=0,n=0,i=0,o=0,a=t.length;a>=16;)r=r+t[o+0]|0,e=e+t[o+1]|0,n=n+t[o+2]|0,i=i+t[o+3]|0,r=r+t[o+4]|0,e=e+t[o+5]|0,n=n+t[o+6]|0,i=i+t[o+7]|0,r=r+t[o+8]|0,e=e+t[o+9]|0,n=n+t[o+10]|0,i=i+t[o+11]|0,r=r+t[o+12]|0,e=e+t[o+13]|0,n=n+t[o+14]|0,i=i+t[o+15]|0,o+=16,a-=16;for(;a>=4;)r=r+t[o+0]|0,e=e+t[o+1]|0,n=n+t[o+2]|0,i=i+t[o+3]|0,o+=4,a-=4;switch(i=((i+(n<<8)|0)+(e<<16)|0)+(r<<24)|0,a){case 3:i=i+(t[o+2]<<8)|0;case 2:i=i+(t[o+1]<<16)|0;case 1:i=i+(t[o+0]<<24)|0}return i>>>0}var o={},a=16,h="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map(function(t){return t.charCodeAt(0)}),s=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];return o.create=function(r,o){var h,s=new e,u=o.length,f=r.length,p=-1;if(s.putInt(u),s.putChar("\n"),a>=f)return s.putInt(u),s.putChar(":"),s.putArray(o),s.putInt(i(o)),s.putChar(";"),s.toArray();var c=Math.ceil(f/a),w=new Array(c),y=new Array(c);for(h=0;h<w.length;h++)w[h]=-1;for(h=0;h<y.length;h++)y[h]=-1;var d,g=new t;for(h=0;f-a>h;h+=a)g.init(r,h),d=g.value()%c,w[h/a]=y[d],y[d]=h/a;for(var v,l,C,A,m,I=0;u>I+a;)for(A=0,m=0,g.init(o,I),h=0,C=0;;){var b=250;for(d=g.value()%c,l=y[d];l>=0&&b-->0;){var E,z,B,x,k,S,D,M;for(v=l*a,x=0,S=v,D=I+h;f>S&&u>D&&r[S]===o[D];x++,S++,D++);for(x--,k=1;v>k&&h>=k&&r[v-k]===o[I+h-k];k++);k--,z=v-k,E=x+k+1,B=h-k,M=n(h-k)+n(E)+n(z)+3,E>=M&&E>C&&(C=E,A=v-k,m=B),l=w[l]}if(C>0){m>0&&(s.putInt(m),s.putChar(":"),s.putArray(o,I,I+m),I+=m),I+=C,s.putInt(C),s.putChar("@"),s.putInt(A),s.putChar(","),A+C-1>p&&(p=A+C-1),C=0;break}if(I+h+a>=u){s.putInt(u-I),s.putChar(":"),s.putArray(o,I,I+u-I),I=u;break}g.next(o[I+h+a]),h++}return u>I&&(s.putInt(u-I),s.putChar(":"),s.putArray(o,I)),s.putInt(i(o)),s.putChar(";"),s.toArray()},o.outputSize=function(t){var e=new r(t),n=e.getInt();if("\n"!==e.getChar())throw new Error("size integer not terminated by '\\n'");return n},o.apply=function(t,n){var o,a=0,h=new r(n),s=t.length,u=n.length;if(o=h.getInt(),"\n"!==h.getChar())throw new Error("size integer not terminated by '\\n'");for(var f=new e;h.haveBytes();){var p,c;switch(p=h.getInt(),h.getChar()){case"@":if(c=h.getInt(),h.haveBytes()&&","!==h.getChar())throw new Error("copy command not terminated by ','");if(a+=p,a>o)throw new Error("copy exceeds output file size");if(c+p>s)throw new Error("copy extends past end of input");f.putArray(t,c,c+p);break;case":":if(a+=p,a>o)throw new Error("insert command gives an output larger than predicted");if(p>u)throw new Error("insert count exceeds size of delta");f.putArray(h.a,h.pos,h.pos+p),h.pos+=p;break;case";":var w=f.toArray();if(p!==i(w))throw new Error("bad checksum");if(a!==o)throw new Error("generated size does not match predicted size");return w;default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")},o});