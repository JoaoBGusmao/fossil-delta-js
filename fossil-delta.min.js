!function(t,r){"undefined"!=typeof module&&module.exports?module.exports=r():t.fossilDelta=r()}(this,function(){function t(){this.a=0,this.b=0,this.i=0,this.z=new Uint8Array(a),this.init=function(t,r){var n,e,i=0,s=0;for(n=0;a>n;n++)e=t[r+n],i=i+e&65535,s=s+(a-n)*e&65535,this.z[n]=e;this.a=65535&i,this.b=65535&s,this.i=0},this.next=function(t){var r=this.z[this.i];this.z[this.i]=t,this.i=this.i+1&a-1,this.a=this.a-r+t&65535,this.b=this.b-a*r+this.a&65535},this.value=function(){return(65535&this.a|(65535&this.b)<<16)>>>0}}function r(t){this.a=t,this.pos=0,this.toArray=function(){return this.a.subarray(0,this.pos)},this.get=function(t){return this.a[this.pos+t]},this.set=function(t,r){this.a[this.pos+t]=r},this.haveBytes=function(){return this.pos<this.a.length},this.subarray=function(t,r){return this.a.subarray(this.pos+t,this.pos+r)},this.incPos=function(t){if(this.pos+=t,this.pos>this.a.length)throw new RangeError("out of bounds")},this.putByte=function(t){this.a[this.pos]=t,this.incPos(1)},this.getByte=function(){var t=this.a[this.pos];return this.incPos(1),t},this.getChar=function(){return String.fromCharCode(this.getByte())},this.putChar=function(t){this.putByte(255&t.charCodeAt(0))},this.putInt=function(t){var r,n,e=[];if(0===t)return void this.putChar("0");for(r=0;t>0;r++,t>>>=6)e.push(u[63&t]);for(n=r-1;n>=0;n--)this.putByte(e[n])},this.getInt=function(){for(var t,r=0;(t=h[127&this.getByte()])>=0;)r=(r<<6)+t;return this.pos--,r>>>0},this.putArray=function(t){for(var r=0;r<t.length;r++)this.a[this.pos++]=t[r];if(this.pos>this.a.length)throw new RangeError("out of bounds: "+t.length+" "+this.pos)}}function n(t){var r,n;for(r=1,n=64;t>=n;r++,n<<=6);return r}function e(t){for(var r=0,n=0,e=0,i=0,s=t.length,a=0;s>=16;)r=r+t[a+0]|0,n=n+t[a+1]|0,e=e+t[a+2]|0,i=i+t[a+3]|0,r=r+t[a+4]|0,n=n+t[a+5]|0,e=e+t[a+6]|0,i=i+t[a+7]|0,r=r+t[a+8]|0,n=n+t[a+9]|0,e=e+t[a+10]|0,i=i+t[a+11]|0,r=r+t[a+12]|0,n=n+t[a+13]|0,e=e+t[a+14]|0,i=i+t[a+15]|0,a+=16,s-=16;for(;s>=4;)r=r+t[a+0]|0,n=n+t[a+1]|0,e=e+t[a+2]|0,i=i+t[a+3]|0,a+=4,s-=4;switch(i=((i+(e<<8)|0)+(n<<16)|0)+(r<<24)|0,s){case 3:i=i+(t[a+2]<<8)|0;case 2:i=i+(t[a+1]<<16)|0;case 1:i=i+(t[a+0]<<24)|0}return i>>>0}function i(t){s.logError?s.logError(t):console.log("ERROR: "+t)}var s={},a=16,u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map(function(t){return t.charCodeAt(0)}),h=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];return s.create=function(i,s){var u,h=new r(new Uint8Array(s.length+60)),o=s.length,f=i.length,p=-1;if(h.putInt(o),h.putChar("\n"),a>=f)return h.putInt(o),h.putChar(":"),h.putArray(s),h.putInt(e(s)),h.putChar(";"),h.toArray();var c=Math.ceil(f/a),l=new Array(c),y=new Array(c);for(u=0;u<l.length;u++)l[u]=-1;for(u=0;u<y.length;u++)y[u]=-1;var g,d=new t;for(u=0;f-a>u;u+=a)d.init(i,u),g=d.value()%c,l[u/a]=y[g],y[g]=u/a;for(var v,b,C,w,A,m=0;o>m+a;)for(w=0,A=0,d.init(s,m),u=0,C=0;;){var I=250;for(g=d.value()%c,b=y[g];b>=0&&I-->0;){var z,B,x,k,E,R,P,U;for(v=b*a,k=0,R=v,P=m+u;f>R&&o>P&&i[R]===s[P];k++,R++,P++);for(k--,E=1;v>E&&u>=E&&i[v-E]===s[m+u-E];E++);E--,B=v-E,z=k+E+1,x=u-E,U=n(u-E)+n(z)+n(B)+3,z>=U&&z>C&&(C=z,w=v-E,A=x),b=l[b]}if(C>0){A>0&&(h.putInt(A),h.putChar(":"),h.putArray(s.subarray(m,m+A)),m+=A),m+=C,h.putInt(C),h.putChar("@"),h.putInt(w),h.putChar(","),w+C-1>p&&(p=w+C-1),C=0;break}if(m+u+a>=o){h.putInt(o-m),h.putChar(":"),h.putArray(s.subarray(m,m+o-m)),m=o;break}d.next(s[m+u+a]),u++}return o>m&&(h.putInt(o-m),h.putChar(":"),h.putArray(s.subarray(m))),h.putInt(e(s)),h.putChar(";"),h.toArray()},s.outputSize=function(t){var n=new r(t),e=n.getInt();return"\n"!==n.getChar()?(i("size integer not terminated by '\\n'"),-1):e},s.apply=function(t,n){var s,a=0,u=new r(n),h=t.length,o=n.length;if(s=u.getInt(),"\n"!==u.getChar())return i("size integer not terminated by '\\n'"),null;for(var f=new r(new Uint8Array(s));u.haveBytes();){var p,c;switch(p=u.getInt(),u.getChar()){case"@":if(c=u.getInt(),u.haveBytes()&&","!==u.getChar())return i("copy command not terminated by ','"),null;if(a+=p,a>s)return i("copy exceeds output file size"),null;if(c+p>h)return i("copy extends past end of input"),null;f.putArray(t.subarray(c,c+p));break;case":":if(a+=p,a>s)return i("insert command gives an output larger than predicted"),null;if(p>o)return i("insert count exceeds size of delta"),null;f.putArray(u.subarray(0,p)),u.pos+=p;break;case";":var l=f.a;return p!==e(l)?(i("bad checksum"),null):a!==s?(i("generated size does not match predicted size"),null):l;default:return i("unknown delta operator"),null}}return i("unterminated delta"),null},s});