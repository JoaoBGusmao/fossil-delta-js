!function(t,r){"undefined"!=typeof module&&module.exports?module.exports=r():t.fossilDelta=r()}(this,function(){function t(){this.a=0,this.b=0,this.i=0,this.z=new Array(a)}function r(t){this.a=t,this.pos=0}function e(){this.a=[]}function n(t){var r,e;for(r=1,e=64;t>=e;r++,e<<=6);return r}function o(t){for(var r=0,e=0,n=0,o=0,i=0,a=t.length;a>=16;)r=r+t[i+0]|0,e=e+t[i+1]|0,n=n+t[i+2]|0,o=o+t[i+3]|0,r=r+t[i+4]|0,e=e+t[i+5]|0,n=n+t[i+6]|0,o=o+t[i+7]|0,r=r+t[i+8]|0,e=e+t[i+9]|0,n=n+t[i+10]|0,o=o+t[i+11]|0,r=r+t[i+12]|0,e=e+t[i+13]|0,n=n+t[i+14]|0,o=o+t[i+15]|0,i+=16,a-=16;for(;a>=4;)r=r+t[i+0]|0,e=e+t[i+1]|0,n=n+t[i+2]|0,o=o+t[i+3]|0,i+=4,a-=4;switch(o=((o+(n<<8)|0)+(e<<16)|0)+(r<<24)|0,a){case 3:o=o+(t[i+2]<<8)|0;case 2:o=o+(t[i+1]<<16)|0;case 1:o=o+(t[i+0]<<24)|0}return o>>>0}var i={},a=16;t.prototype.init=function(t,r){var e,n,o=0,i=0;for(e=0;a>e;e++)n=t[r+e],o=o+n&65535,i=i+(a-e)*n&65535,this.z[e]=n;this.a=65535&o,this.b=65535&i,this.i=0},t.prototype.next=function(t){var r=this.z[this.i];this.z[this.i]=t,this.i=this.i+1&a-1,this.a=this.a-r+t&65535,this.b=this.b-a*r+this.a&65535},t.prototype.value=function(){return(65535&this.a|(65535&this.b)<<16)>>>0};var h="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map(function(t){return t.charCodeAt(0)}),u=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];return r.prototype.haveBytes=function(){return this.pos<this.a.length},r.prototype.getByte=function(){var t=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw new RangeError("out of bounds");return t},r.prototype.getChar=function(){return String.fromCharCode(this.getByte())},r.prototype.getInt=function(){for(var t,r=0;this.haveBytes()&&(t=u[127&this.getByte()])>=0;)r=(r<<6)+t;return this.pos--,r>>>0},e.prototype.toArray=function(){return this.a},e.prototype.putByte=function(t){this.a.push(255&t)},e.prototype.putChar=function(t){this.putByte(t.charCodeAt(0))},e.prototype.putInt=function(t){var r,e,n=[];if(0===t)return void this.putChar("0");for(r=0;t>0;r++,t>>>=6)n.push(h[63&t]);for(e=r-1;e>=0;e--)this.putByte(n[e])},e.prototype.putArray=function(t,r,e){"undefined"==typeof r&&(r=0),"undefined"==typeof e&&(e=t.length-r);for(var n=r;e>n;n++)this.a.push(t[n])},i.create=function(r,i){var h,u=new e,p=i.length,s=r.length,f=-1;if(u.putInt(p),u.putChar("\n"),a>=s)return u.putInt(p),u.putChar(":"),u.putArray(i),u.putInt(o(i)),u.putChar(";"),u.toArray();var c=Math.ceil(s/a),y=new Array(c),d=new Array(c);for(h=0;h<y.length;h++)y[h]=-1;for(h=0;h<d.length;h++)d[h]=-1;var w,g=new t;for(h=0;s-a>h;h+=a)g.init(r,h),w=g.value()%c,y[h/a]=d[w],d[w]=h/a;for(var v,l,C,A,m,I=0;p>I+a;)for(A=0,m=0,g.init(i,I),h=0,C=0;;){var b=250;for(w=g.value()%c,l=d[w];l>=0&&b-->0;){var E,z,B,x,k,S,D,M;for(v=l*a,x=0,S=v,D=I+h;s>S&&p>D&&r[S]===i[D];x++,S++,D++);for(x--,k=1;v>k&&h>=k&&r[v-k]===i[I+h-k];k++);k--,z=v-k,E=x+k+1,B=h-k,M=n(h-k)+n(E)+n(z)+3,E>=M&&E>C&&(C=E,A=v-k,m=B),l=y[l]}if(C>0){m>0&&(u.putInt(m),u.putChar(":"),u.putArray(i,I,I+m),I+=m),I+=C,u.putInt(C),u.putChar("@"),u.putInt(A),u.putChar(","),A+C-1>f&&(f=A+C-1),C=0;break}if(I+h+a>=p){u.putInt(p-I),u.putChar(":"),u.putArray(i,I,I+p-I),I=p;break}g.next(i[I+h+a]),h++}return p>I&&(u.putInt(p-I),u.putChar(":"),u.putArray(i,I,I+p-I)),u.putInt(o(i)),u.putChar(";"),u.toArray()},i.outputSize=function(t){var e=new r(t),n=e.getInt();if("\n"!==e.getChar())throw new Error("size integer not terminated by '\\n'");return n},i.apply=function(t,n){var i,a=0,h=new r(n),u=t.length,p=n.length;if(i=h.getInt(),"\n"!==h.getChar())throw new Error("size integer not terminated by '\\n'");for(var s=new e;h.haveBytes();){var f,c;switch(f=h.getInt(),h.getChar()){case"@":if(c=h.getInt(),h.haveBytes()&&","!==h.getChar())throw new Error("copy command not terminated by ','");if(a+=f,a>i)throw new Error("copy exceeds output file size");if(c+f>u)throw new Error("copy extends past end of input");s.putArray(t,c,c+f);break;case":":if(a+=f,a>i)throw new Error("insert command gives an output larger than predicted");if(f>p)throw new Error("insert count exceeds size of delta");s.putArray(h.a,h.pos,h.pos+f),h.pos+=f;break;case";":var y=s.toArray();if(f!==o(y))throw new Error("bad checksum");if(a!==i)throw new Error("generated size does not match predicted size");return y;default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")},i});